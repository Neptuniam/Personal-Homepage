<!DOCTYPE html>
<html>
  <head>
    <title>the 134 Homepage</title>
    <meta charset="utf-8">

    <!-- Tab icon -->
    <link rel="shortcut icon" href="otherImages//homeIcon.ico">

    <!-- Weather icons -->
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> -->
    <!-- <link rel="stylesheet" href="css/styles.css"> -->
    <link rel="stylesheet" href="weatherIcons/weather-icons.css">
    <link rel="stylesheet" href="weatherIcons/weather-icons-wind.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Arima+Madurai|Bangers|Gruppo|Nixie+One|Noto+Serif|Nova+Flat|Poiret+One|Shrikhand" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Playball" rel="stylesheet">
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script> -->

    <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->

    <style media="screen">
      [v-cloak] { display:none; }
      body {
        background-size: fill;
      }

      .box {
        position:relative;
        border: 1px solid;
        padding: 1.3em;
        margin: 1em;
      }

      .circle {
        /* position: relative; */
        border-radius: 50%;
        /* display: inline-block; */
        /* padding: 1.3em;*/
        /* margin: 1em; */
      }

      .linkColourChange {
        color: white;
        text-decoration: none;
       }

      .transparentImage {
         background: transparent url('otherImages//homeToSchool_410x120.jpg') no-repeat 0 0;
         width: 540px;
         height: 440px;
         float: left;
         filter: alpha(opacity=30);
         opacity: 0.3;
       }

      .date-time{
        -webkit-touch-callout: none; /* iOS Safari */
          -webkit-user-select: none; /* Safari */
           -khtml-user-select: none; /* Konqueror HTML */
             -moz-user-select: none; /* Firefox */
              -ms-user-select: none; /* Internet Explorer/Edge */
                  user-select: none;
      }

      .clockSize {
        font-size: 800%;
        color: rgba(0,0,0,8);

        text-shadow: 0 0 0.5px #fff, 0 0 0.5px #fff, 0 0 0.5px #fff
      }

      .dateSize {
        /* font-size: 175%; */
        font-size: 200%;
        color: rgba(0,0,0,8);
        margin-top: -1em;

        /* text-shadow: 0 0 .001px #fff, 0 0 .001px #fff, 0 0 .001px #fff */
      }

      .clock {
        text-align: center;
        font-family: 'Playball', cursive;
      }

      .favButtons {
        width: 40px;
        height:40px;
      }

      .dashboard {
        text-align: center;
        font-family: 'Gruppo', cursive;
      }

      .forecastStyle {
        background: rgba(200,200,200,.95);
        width:55px;
      }

      .forecastIcons {
        position: absolute;
        top: 17%;
        left: 3%;

        font-size: 16px;
        opacity: .90;
      }

      .busNumIconStyle {
        height: 35px;
        width: 35px;

        border-radius: 50%;

        font-size: 140%;

        position:absolute;
        top: 35%;
        left: 2%;
      }

      .top-left {
        position:absolute;
        top: -1px;
        left: 5px;
      }

      .bottom-left {
        position:absolute;
        bottom: 1;
        right: -0.5;
      }

      .bottom-center {
        position:absolute;
        bottom: 0px;
        left: 30%;
        /* top: 30px; */
        /* text-align: center; */
      }

      .top-right {
        position:absolute;
        top: -1px;
        right: 5px;
      }

      .mid-right {
        position: absolute;
        top: 15px;
        right: 5px;
      }

      .bottom-right {
        position:absolute;
        bottom: 1;
        right: -0.5;
      }

      blink {
          -webkit-animation: 0.9s linear infinite condemned_blink_effect; // for android
          animation: 0.9s linear infinite condemned_blink_effect;
      }
      @-webkit-keyframes condemned_blink_effect { // for android
          0% {
              visibility: hidden;
          }
          50% {
              visibility: hidden;
          }
          100% {
              visibility: visible;
          }
      }
      @keyframes condemned_blink_effect {
          0% {
              visibility: hidden;
          }
          50% {
              visibility: hidden;
          }
          100% {
              visibility: visible;
          }
      }
    </style>

    <!-- Google maps API KEy: AIzaSyAuZODWQu06M9hC-sGrhazBKCrLIIj9fzI -->
  </head>
  <body>
    <div id="app">
      <div class="row">
        <br><br>
        <div class="col s10 l6">
          <!--Time Div-->
          <div class="date-time">
            <!--Time Row-->
            <div class="clock">
              <div class="row">
                <div class="col s12">
                  <br>
                  <!-- The Vue instance is attached to this div -->
                  <div>
                    <div>
                      <!-- Reference the variable currtime in Vue Instance -->
                      <em class="clockSize" v-cloak>{{currhour}}<blink>:</blink>{{currmin}}&nbsp;</em>
                    </div>
                    <div>
                      <!-- Reference the variable currdate in Vue Instance -->
                      <p class="dateSize" v-cloak v-text="currdate">&nbsp;</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <br><br>

          <!--Browser Card-->
          <div class="" style="margin:0 auto; width:420px;">
            <div class="card" style="background: rgba(240,240,240,0.5);">
              <div class="card-content">
                <!--Google basic search bar-->
                <form method="get" action="http://www.google.com/search">
                <div class="input-field">
                  <i class="material-icons prefix">search</i>
                  <input id="icon_prefix" name="q" placeholder="Search Google" type="text">
                  <label for="icon_prefix"></label>
                </div>
              </form>

                <!--Favourite tabs Row-->
                <div class="row">
                  <div class="col s2 offset-s1 center-align">
                    <a href="https://www.facebook.com/messages/t/1257203164296324"><img src="favouritesIcons//facebook.png" class="favButtons"></a>
                  </div>
                  <div class="col s2 center-align">
                    <a href="https://www.reddit.com/"><img src="favouritesIcons//Reddit-The-Official-App-Icon.png" class="favButtons"></a>
                  </div>
                  <div class="col s2 center-align">
                    <a href="https://easyweb.td.com/waw/idp/login.htm?execution=e1s1">  <img src="favouritesIcons//TD-bank-icon.png" class="favButtons"></a>
                  </div>
                  <div class="col s2 center-align">
                    <a href="https://www.youtube.com/feed/subscriptions"><img src="favouritesIcons//youtube.png" class="favButtons"></a>
                  </div>
                  <div class="col s2 center-align">
                    <a href="https://www.netflix.com/browse"><img src="favouritesIcons//netflix.png" class="favButtons"></a>
                  </div>
                </div>
                <!--Favourite tabs Row2-->
                <div class="row">
                  <div class="col s2 center-align offset-s1">
                    <a href="https://github.com/"><img src="favouritesIcons//git.png" class="favButtons"></a>
                  </div>
                  <div class="col s2 center-align">
                    <a href="https://drive.google.com/drive/my-drive"><img src="favouritesIcons//googleDrive.png" class="favButtons"></a>
                  </div>
                  <div class="col s2 center-align">
                    <a href="https://www.google.ca/maps?hl=en&tab=wl"><img src="favouritesIcons//maps.png" class="favButtons"></a>
                  </div>
                  <div class="col s2 center-align">
                    <a href="https://outlook.office.com/owa/?realm=uoguelph.ca">  <img src="favouritesIcons//gmail.png" class="favButtons"></a>
                  </div>
                  <div class="col s2 center-align">
                    <a href="https://courselink.uoguelph.ca/d2l/home"><img src="favouritesIcons//guelph.jpeg" class="favButtons"></a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col s4 offset-s1">
          <!--Dashboard Card-->
          <br><br><br><br>
          <!-- display:none; -->
          <div class="card dashboard" style="margin:0 auto; height: 480px; width:440px; background: rgba(240,240,240,0.8);">
            <div class="card-content">
              <!--Current Weather Row-->
              <div class="row">
                <!--Current tempature-->
                <div class="col s6 push-s1" id="currentTemp" style="font-size:65px;">
                </div>
                <!--Weather Icon-->
                <div class="col s6 pull-s1 center-align">
                  <br>
                  <i id="weatherIcon" style="font-size: 60px;"></i>
                </div>

                <!--Forecast Description row-->
                <div class="row">
                  <div class="col s12" id="currentTempText" style="font-family: 'Arima Madurai', cursive;"></div>
                  <div class="col s12" id="currentTempRange"></div>
                  <div class="col s12" id="currentLocation" contenteditable="true"></div>
                </div>

                <!--Weekly Weather Forecast box-->
                <div class="box" style="height:130px; background: url('otherImages//weatherBackground.jpg');">
                  <div class="row">

                    <div class="col s1 pull-s1">
                      <div class="box forecastStyle" style=" ">
                        <i class="forecastIcons " id="day0Icon"></i>
                        <div class="top-right" id="day0High"></div>
                        <div class="mid-right" id="day0Low"></div><br>
                        <div class="bottom-center" id="day0Date" style = "font-size: 80%;"></div>
                      </div>
                    </div>

                    <div class="col s2">
                      <div class="box forecastStyle">
                        <i class="forecastIcons " id="day1Icon"></i>
                        <span class="top-right" id="day1High"></span>
                        <span class="mid-right" id="day1Low"></span><br>
                        <span class="bottom-center" id="day1Date" style = "font-size: 80%;"></span>
                      </div>
                    </div>


                    <div class="col s2">
                      <div class="box forecastStyle">
                        <i class="forecastIcons " id="day2Icon"></i>
                        <span class="top-right" id="day2High"></span>
                        <span class="mid-right" id="day2Low"></span><br>
                        <span class="bottom-center" id="day2Date" style = "font-size: 80%;"></span>
                      </div>
                    </div>

                    <div class="col s2">
                      <div class="box forecastStyle">
                        <i class="forecastIcons " id="day3Icon"></i>
                        <span class="top-right" id="day3High"></span>
                        <span class="mid-right" id="day3Low"></span><br>
                        <span class="bottom-center" id="day3Date" style = "font-size: 80%;"></span>
                      </div>
                    </div>

                    <div class="col s2">
                      <div class="box forecastStyle">
                        <i class="forecastIcons " id="day4Icon"></i>
                        <span class="top-right" id="day4High"></span>
                        <span class="mid-right" id="day4Low"></span><br>
                        <span class="bottom-center" id="day4Date" style = "font-size: 80%;"></span>
                      </div>
                    </div>

                    <div class="col s2">
                      <div class="box forecastStyle">
                        <i class="forecastIcons " id="day5Icon"></i>
                        <span class="top-right" id="day5High"></span>
                        <span class="mid-right" id="day5Low"></span><br>
                        <span class="bottom-center" id="day5Date" style = "font-size: 80%;"></span>
                      </div>
                    </div>

                  </div>
                </div>

                <!--Bus Schedule box-->
                <div class="box" style="height: 95px; background: url('otherImages//homeToSchool_410x120.jpg');">
                  <div class="row">
                    <a href="maps.html" target="_blank" class="busNumIconStyle linkColourChange" id="busNumIcon"></a>

                    <div class="col s7" style="font-size:130%;">
                      <b>Leave: </b>
                      <b id="busLeaveTime"></b>
                      <br>
                      <b>Arrive: </b>
                      <b id="busArriveTime"></b>
                    </div>

                    <div class="col s5" style="font-size:130%">
                      <b>Start: <b>
                      <b id="busOrigin"></b>
                      <br>
                      <b>End: </b>
                      <b id="busDestination"></b>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
<!--Clock Script-->
<script src="vue.min.js"></script>
<script src="moment.js" charset="utf-8"></script>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script type="text/javascript">
  new Vue({
    /* Vue will be attached to this ID */
    el: '#app',
    /* variables are stored in data */
    data: {
        currhour: '', currmin: '', currdate: ''
    },
    /* Methods are defined in here */
    methods: {
      get_time() {
        /* Get the current date from moment.js.  learn more about formatting at: https://momentjs.com/docs/#/displaying/format/ */
        var split = moment().format("dddd, MMMM Do YYYY_h_mm a").split('_')

        /* Set instance variables */
    		this.currdate = split[0]
    		this.currhour = split[1]
    		this.currmin  = split[2]
      },
    },

    /* This is called when the Vue instance is mounted to #app
        similar to a constructor method */
    mounted() {
        /* Call get_time on via timer, every second */
        this.get_time()
        this.interval = setInterval(this.get_time, 1000)
    },
    beforeDestroy() {
        clearInterval(this.interval)
    }
  });
</script>
<!-- JQuery download link (Need to use for following script) -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<!-- Ajax script to run 'clientSide.php' and retrieve a random background -->
<script>
  $(document).ready(function() {
    $.ajax({
      url:'clientSide.php',
      method:'POST',
      success:function(data){
        try {
          console.log("Background: " + data);
          if (String(data) == "backgrounds/" || String(data) == "backgrounds/" || data == "")
            throw "backgrounds/earthporn24.png";

          document.body.style.background = "#f3f3f3 url(\'" + data + "\') no-repeat fixed center";
        } catch(err) {
          document.body.style.background = "#f3f3f3 url(\'" + err + "\') no-repeat fixed center";
        }
     }
   });
  });
</script>

<p id="userPosition" style="visibility: hidden;"></p>

<!-- Get weekly weather info -->
<script>
  var x = document.getElementById("userPosition");
  var customLocation = "";

  var input = document.getElementById("currentLocation");
  input.addEventListener("keyup", function(event) {
      event.preventDefault();
      if (event.keyCode === 13) {
          // document.getElementById("myBtn").click();
          customLocation = document.getElementById("currentLocation").innerHTML;
          customLocation = customLocation.slice(customLocation.indexOf('>') + 2, customLocation.length);
          customLocation = customLocation.slice(0, customLocation.indexOf('<'));
          // alert(customLocation);
          displayWeather();
      }
  });

  function getIcon(lastBuildTime, sunset, curWeather) {
    // console.log("Current text: " + curWeather);
    var iconText = "wi wi-"

    // IFf lastBuildTime == FORECAST, we are gettin icon for weekly forecast and therefor do not want time specific icons
    if (lastBuildTime != "FORECAST") {
      if (lastBuildTime.includes("AM"))
        iconText += "day-";
      else if (lastBuildTime.includes("PM")) {
        // If it is in the PM, we need to check if it is after sunset
        var i = 15;

        // Loop till colon of buildTime in order to parse the build time (current Time)
        while (lastBuildTime.charCodeAt(i) != 58) i++;

        // Current build time hour is always double digit (i.e. 07:28 or 10:28). Get those digits
        var curHour = lastBuildTime[i-2] + lastBuildTime[i-1];

        // Set setHour to empty value and reset loop index
        var setHour = "";
        i = 0;

        // Copy characters until we hit the colon
        while (sunset.charCodeAt(i) != 58)
          setHour += sunset[i++];

        // Check if it is after sunset
        if (parseInt(curHour) < parseInt(setHour))
          iconText += "day-";
        else
          iconText += "night-alt-"

      }
    }

    // Determine which icon to display
    if (curWeather.includes("sunny") || curWeather.includes("hot"))
      iconText = "wi wi-day-sunny";
    else if (curWeather.includes("clear"))
      iconText = "wi wi-stars";
    else if (curWeather.includes("fair"))
      iconText = "wi wi-day-sunny-overcast";
    else if (curWeather.includes("cloud")) {
      iconText += "cloudy";

      if (curWeather.includes("wind"))
        iconText += "-windy";
    }
    else if (curWeather.includes("mixed"))
      iconText += "rain-mix";
    else if (curWeather.includes("rain"))
      iconText += "rain";
    else if (curWeather.includes("showers") || curWeather.includes("drizzle"))
      iconText += "showers";
    else if (curWeather.includes("thunderstorms"))
      iconText += "storm-showers";
    else if (curWeather.includes("snow"))
      iconText += "snow";
    else if (curWeather.includes("foggy") || curWeather.includes("haze") ||
             curWeather.includes("dust")  || curWeather.includes("smokey"))
      iconText += "fog";
    else if (curWeather.includes("wind"))
      iconText += "windy";

    // console.log("iconText: " + iconText);

    return(iconText)

  }

  function getLocation() {
    if (navigator.geolocation) {
        return(navigator.geolocation.getCurrentPosition(showPosition));
    } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
  }

  function showPosition(position) {
    x.innerHTML = position.coords.latitude +  "," + position.coords.longitude;
    console.log("Current Location: " + x.innerHTML);

    displayWeather();
  }

  function displayWeather() {
    var location;

    if (customLocation != "")
      location = customLocation;
    else
     location = document.getElementById("userPosition").innerHTML;

    $.get("https://query.yahooapis.com/v1/public/yql?q=select * from weather.forecast where woeid in (select woeid from geo.places where text=\"(" + location + ")\") and u='c'&format=json", function (data) {        })
    .done(function(data) {
      /* Check that a place was found (we'll just grab the first) */
      if (data.query.results === null) {
          bootbox.alert("Location not found: " + location + "!");
      } else {
        // get weather icon
        document.getElementById('weatherIcon').className = getIcon(data.query.results.channel.lastBuildDate, data.query.results.channel.astronomy.sunset, (data.query.results.channel.item.condition.text).toLowerCase());
        // getIcon("Tue, 15 May 2018 09:29 PM CST", "8:54", "rain".toLowerCase());

        // Set actual time weather
        document.getElementById('currentTemp').innerHTML = data.query.results.channel.item.condition.temp + "&deg;C";
        document.getElementById('currentTempText').innerHTML = data.query.results.channel.item.condition.text;
        document.getElementById('currentTempRange'). innerHTML = data.query.results.channel.item.forecast[0].low + "&deg;C - " + data.query.results.channel.item.forecast[0].high + "&deg;C";// : 60%";

        document.getElementById('currentLocation').innerHTML = "<img src=\"otherImages/locationDrop.png\" style=\"width:10px;\"> " + data.query.results.channel.location.city + ", " + data.query.results.channel.location.region;

        // Loop through forecast and change weekly forecast highs, lows and days
        for (var i = 0; i < 6; i++) {
          document.getElementById('day' + i + 'Icon').className += getIcon("FORCAST", "-1", (data.query.results.channel.item.forecast[i+1].text).toLowerCase());
          document.getElementById('day' + i + 'High').innerHTML = data.query.results.channel.item.forecast[i+1].high + "&deg;C";
          document.getElementById('day' + i +'Low').innerHTML = data.query.results.channel.item.forecast[i+1].low + "&deg;C";
          document.getElementById('day' + i +'Date').innerHTML = data.query.results.channel.item.forecast[i+1].day;
        }
      }
    });
  }

  getLocation();
</script>

<script>
  $(document).ready(function() {
    $.ajax({
      url:'mapsData.php',
      method:'GET',
      data: {"location": document.getElementById('userPosition').innerHTML},
      success:function(data) {
       try {
         // console.log("Data: " + data);
         var pData = JSON.parse(data);
         // console.log("pData: " + pData);

         if (pData.geocoded_waypoints[0].geocoder_status != "OK") throw "Waypoint Failed";

         var i = 0;
         // Find first step that is transit
         while ((pData.routes[0].legs[0].steps[i].travel_mode).toLowerCase() != "transit") i++;

         // Set bus number and colour
         document.getElementById('busNumIcon').innerHTML =  pData.routes[0].legs[0].steps[i].transit_details.line.short_name;
         document.getElementById('busNumIcon').style.backgroundColor = pData.routes[0].legs[0].steps[i].transit_details.line.color;

         //Set arrival/departure Times
         document.getElementById('busLeaveTime').innerHTML  = pData.routes[0].legs[0].departure_time.text;
         document.getElementById('busArriveTime').innerHTML = pData.routes[0].legs[0].arrival_time.text;

         // Check end address for nicer printing
         //Home
         if (pData.routes[0].legs[0].start_address == "134 Harvard Rd, Guelph, ON N1G 3R1, Canada") {
           document.getElementById('busOrigin').innerHTML = " Home";
           document.getElementById('busDestination').innerHTML = "School";
         }
         //School
         else if (pData.routes[0].legs[0].start_address == "University Centre, Guelph, ON N1G 1Y4, Canada") {
           document.getElementById('busOrigin').innerHTML = " Shool";
           document.getElementById('busDestination').innerHTML = "Home";
         }
         //Otherwise just use current address
         else {
           var startAddress = (pData.routes[0].legs[0].start_address).slice(0, (pData.routes[0].legs[0].start_address).indexOf(","));
           document.getElementById('busOrigin').style.fontSize = 130 / (startAddress.length/4.4) + "%";
           document.getElementById('busOrigin').innerHTML = startAddress;
           document.getElementById('busDestination').innerHTML = "Home";
         }
       }
       catch(err) {
         console.log("maps error: " + err);
       }
     }
  });
});
</script>
